D0_3649 <- as.data.frame(apply(cpm_in_cutoff[,10:11], 1, mean))
D0_40300 <- as.data.frame(apply(cpm_in_cutoff[,12:13], 1, mean))
D0_4955 <- as.data.frame(apply(cpm_in_cutoff[,14:15], 1, mean))
# Day 1 technical replicates
D1_20157 <- as.data.frame(apply(cpm_in_cutoff[,16:17], 1, mean))
D1_28815 <- as.data.frame(apply(cpm_in_cutoff[,21:22], 1, mean))
D1_3647 <- as.data.frame(apply(cpm_in_cutoff[,24:25], 1, mean))
D1_3649 <- as.data.frame(apply(cpm_in_cutoff[,26:27], 1, mean))
D1_40300 <- as.data.frame(apply(cpm_in_cutoff[,28:29], 1, mean))
D1_4955 <- as.data.frame(apply(cpm_in_cutoff[,30:31], 1, mean))
# Day 2 technical replicates
D2_20157 <- as.data.frame(apply(cpm_in_cutoff[,32:33], 1, mean))
D2_28815 <- as.data.frame(apply(cpm_in_cutoff[,37:38], 1, mean))
D2_3647 <- as.data.frame(apply(cpm_in_cutoff[,40:41], 1, mean))
D2_3649 <- as.data.frame(apply(cpm_in_cutoff[,42:43], 1, mean))
D2_40300 <- as.data.frame(apply(cpm_in_cutoff[,44:45], 1, mean))
D2_4955 <- as.data.frame(apply(cpm_in_cutoff[,46:47], 1, mean))
# Day 3 technical replicates
D3_20157 <- as.data.frame(apply(cpm_in_cutoff[,48:49], 1, mean))
D3_28815 <- as.data.frame(apply(cpm_in_cutoff[,53:54], 1, mean))
D3_3647 <- as.data.frame(apply(cpm_in_cutoff[,56:57], 1, mean))
D3_3649 <- as.data.frame(apply(cpm_in_cutoff[,58:59], 1, mean))
D3_40300 <- as.data.frame(apply(cpm_in_cutoff[,60:61], 1, mean))
D3_4955 <- as.data.frame(apply(cpm_in_cutoff[,62:63], 1, mean))
# Create a new data frame with all of the combined technical replicates
mean_tech_reps <- cbind(cpm_in_cutoff[,1:4], D0_28815, cpm_in_cutoff[,7], D0_3647, D0_3649, D0_40300, D0_4955, D1_20157, cpm_in_cutoff[,18:20], D1_28815, cpm_in_cutoff[,23], D1_3647, D1_3649, D1_40300, D1_4955, D2_20157, cpm_in_cutoff[,34:36], D2_28815, cpm_in_cutoff[,39], D2_3647, D2_3649, D2_40300, D2_4955, D3_20157, cpm_in_cutoff[,50:52], D3_28815, cpm_in_cutoff[,55], D3_3647, D3_3649, D3_40300, D3_4955)
colnames(mean_tech_reps) <- c("D0_20157", "D0_20961", "D0_21792", "D0_28162", "D0_28815", "D0_29089", "D0_3647", "D0_3649", "D0_40300", "D0_4955", "D1_20157", "D1_20961", "D1_21792", "D1_28162", "D1_28815", "D1_29089", "D1_3647", "D1_3649", "D1_40300", "D1_4955", "D2_20157", "D2_20961", "D2_21792", "D2_28162", "D2_28815", "D2_29089", "D2_3647", "D2_3649", "D2_40300", "D2_4955", "D3_20157", "D3_20961", "D3_21792", "D3_28162", "D3_28815", "D3_29089", "D3_3647", "D3_3649", "D3_40300", "D3_4955")
dim(mean_tech_reps)
# Make a column for which are averaged or not
averaged_status <- c(1,1,1,1,2,1,2,2,2,2,2,1,1,1,2,1,2,2,2,2,2,1,1,1,2,1,2,2,2,2,2,1,1,1,2,1,2,2,2,2)
# Find the technical factors for the biological replicates (no technical replicates)
bio_rep_samplefactors <- read.delim("~/Downloads/samplefactors-filtered.txt", stringsAsFactors=FALSE)
day <- bio_rep_samplefactors$Day
species <- bio_rep_samplefactors$Species
# Make PCA plots with the factors colored by day
pca_genes <- prcomp(t(mean_tech_reps), scale = T, retx = TRUE, center = TRUE)
matrixpca <- pca_genes$x
pc1 <- matrixpca[,1]
pc2 <- matrixpca[,2]
pc3 <- matrixpca[,3]
pc4 <- matrixpca[,4]
pc5 <- matrixpca[,5]
pcs <- data.frame(pc1, pc2, pc3, pc4, pc5)
summary <- summary(pca_genes)
#dev.off()
ggplot(data=pcs, aes(x=pc1, y=pc2, color=as.factor(day+1), shape=as.factor(averaged_status), size=2)) + geom_point() + xlab(paste("PC1 (",(summary$importance[2,1]*100), "% of variance)")) + ylab(paste("PC2 (",(summary$importance[2,2]*100), "% of variance)")) + theme_minimal() + guides(color = guide_legend(order=1), size = FALSE, shape = guide_legend(order=3)) + scale_color_discrete(name  ="Day", labels = c("0", "1", "2", "3")) +  scale_shape_manual(values = c(5, 7)) + scale_shape_discrete(name  ="Replicate status", labels = c("Single" ,"Averaged")) + labs(title = "PCs 1 and 2 from global normalized expression")
ggplot(data=pcs, aes(x=pc1, y=pc2, color=as.factor(day+1), shape=as.factor(averaged_status), size=2)) + geom_point() + xlab(paste("PC1 (",(summary$importance[2,1]*100), "% of variance)")) + ylab(paste("PC2 (",(summary$importance[2,2]*100), "% of variance)")) + scale_shape_manual(values = c(5, 8)) + scale_color_discrete(name  ="Day", labels = c("0", "1", "2", "3"))  + labs(title = "PCs 1 and 2 from global normalized gene expression (Averaged bet. technical replicates)")
humans_day0_var <- as.data.frame(apply(as.data.frame(mean_tech_reps[,1:6]),1, var) )
colnames(humans_day0_var) <- c("Variance")
chimps_day0_var <- as.data.frame(apply(as.data.frame(mean_tech_reps[,7:10]),1, var))
colnames(chimps_day0_var) <- c("Variance")
humans_day1_var <- as.data.frame(apply(as.data.frame(mean_tech_reps[,11:16]),1, var))
colnames(humans_day1_var) <- c("Variance")
chimps_day1_var <- as.data.frame(apply(as.data.frame(mean_tech_reps[,17:20]),1, var))
colnames(chimps_day1_var) <- c("Variance")
humans_day2_var <- as.data.frame(apply(as.data.frame(mean_tech_reps[,21:26]),1, var))
colnames(humans_day2_var) <- c("Variance")
chimps_day2_var <- as.data.frame(apply(as.data.frame(mean_tech_reps[,27:30]),1, var))
colnames(chimps_day2_var) <- c("Variance")
humans_day3_var <- as.data.frame(apply(as.data.frame(mean_tech_reps[,31:36]),1, var))
colnames(humans_day3_var) <- c("Variance")
chimps_day3_var <- as.data.frame(apply(as.data.frame(mean_tech_reps[,37:40]),1, var))
colnames(chimps_day3_var) <- c("Variance")
humans_day0_mean <- apply(as.data.frame(mean_tech_reps[,1:6]),1, mean)
chimps_day0_mean <- apply(as.data.frame(mean_tech_reps[,7:10]),1, mean)
humans_day1_mean <- apply(as.data.frame(mean_tech_reps[,11:16]),1, mean)
chimps_day1_mean <- apply(as.data.frame(mean_tech_reps[,17:20]),1, mean)
humans_day2_mean <- apply(as.data.frame(mean_tech_reps[,21:26]),1, mean)
chimps_day2_mean <- apply(as.data.frame(mean_tech_reps[,27:30]),1, mean)
humans_day3_mean <- apply(as.data.frame(mean_tech_reps[,31:36]),1, mean)
chimps_day3_mean <- apply(as.data.frame(mean_tech_reps[,37:40]),1, mean)
# Make arrays with all the means
labels1 <- array("Chimp Day 0", dim = c(10304, 1))
labels2 <- array("Chimp Day 1", dim = c(10304, 1))
labels3 <- array("Chimp Day 2", dim = c(10304, 1))
labels4 <- array("Chimp Day 3", dim = c(10304, 1))
labels5 <- array("Human Day 0", dim = c(10304, 1))
labels6 <- array("Human Day 1", dim = c(10304, 1))
labels7 <- array("Human Day 2", dim = c(10304, 1))
labels8 <- array("Human Day 3", dim = c(10304, 1))
# Make species-day labels
labels9 <- rbind(labels1, labels2, labels3, labels4, labels5, labels6, labels7, labels8)
labels <- as.numeric(as.factor(labels9))
# Make labels so same days from different species are the same color
labels10 <- rbind(labels1, labels2, labels3, labels4, labels1, labels2, labels3, labels4)
labels10 <- as.numeric(as.factor(labels10))
#1 Overall trend across genes
# Boxplot of variances gives general trend
HC_var <- rbind(as.data.frame(chimps_day0_var), as.data.frame(chimps_day1_var), as.data.frame(chimps_day2_var), as.data.frame(chimps_day3_var), as.data.frame(humans_day0_var), as.data.frame(humans_day1_var), as.data.frame(humans_day2_var), as.data.frame(humans_day3_var))
HC_var_labels <- cbind(HC_var, labels, labels10)
p <- ggplot(HC_var_labels, aes(x = factor(labels), y = HC_var))
p <- p + geom_violin(aes(fill = factor(labels10)), show.legend = FALSE) + geom_boxplot(aes(fill = factor(labels10)), show.legend = FALSE, outlier.shape = NA,width=0.2) + scale_y_continuous(trans = "log2") + ggtitle("Variance for each gene by species and day") + xlab("Species-Day Pair") + ylab("Variance for each gene")
p <- p + scale_x_discrete(labels=c("1" = "C Day 0", "2" = "C Day 1", "3" = "C Day 2", "4" = "C Day 3", "5" = "H Day 0", "6" = "H Day 1", "7" = "H Day 2", "8" = "H Day 3"))
p
HC_mean <- rbind(as.data.frame(chimps_day0_mean), as.data.frame(chimps_day1_mean), as.data.frame(chimps_day2_mean), as.data.frame(chimps_day3_mean), as.data.frame(humans_day0_mean), as.data.frame(humans_day1_mean), as.data.frame(humans_day2_mean), as.data.frame(humans_day3_mean))
HC_mean_labels <- cbind(HC_mean, labels, labels10)
m <- ggplot(HC_mean_labels, aes(x = factor(labels), y = HC_mean))
m <- m + geom_violin(aes(fill = factor(labels10)), show.legend = FALSE) + geom_boxplot(aes(fill = factor(labels10)), show.legend = FALSE, outlier.shape = NA,width=0.2) + scale_y_continuous(trans = "log2") + ggtitle("Mean for each gene by species and day") + xlab("Species-Day Pair") + ylab("Mean for each gene")
m <- m + scale_x_discrete(labels=c("1" = "C Day 0", "2" = "C Day 1", "3" = "C Day 2", "4" = "C Day 3", "5" = "H Day 0", "6" = "H Day 1", "7" = "H Day 2", "8" = "H Day 3"))
m
humans_day0_mean <- apply(as.data.frame(mean_tech_reps[,1:6]),1, mean)
colnames(humans_day0_mean) <- c("Mean")
chimps_day0_mean <- apply(as.data.frame(mean_tech_reps[,7:10]),1, mean)
colnames(chimps_day0_mean) <- c("Mean")
humans_day1_mean <- apply(as.data.frame(mean_tech_reps[,11:16]),1, mean)
colnames(humans_day1_mean) <- c("Mean")
chimps_day1_mean <- apply(as.data.frame(mean_tech_reps[,17:20]),1, mean)
colnames(chimps_day1_mean) <- c("Mean")
humans_day2_mean <- apply(as.data.frame(mean_tech_reps[,21:26]),1, mean)
colnames(humans_day2_mean) <- c("Mean")
chimps_day2_mean <- apply(as.data.frame(mean_tech_reps[,27:30]),1, mean)
colnames(chimps_day2_mean) <- c("Mean")
humans_day3_mean <- apply(as.data.frame(mean_tech_reps[,31:36]),1, mean)
colnames(humans_day3_mean) <- c("Mean")
chimps_day3_mean <- apply(as.data.frame(mean_tech_reps[,37:40]),1, mean)
colnames(chimps_day3_mean) <- c("Mean")
humans_day0_mean <- apply(as.data.frame(mean_tech_reps[,1:6]),1, mean)
View(humans_day0_mean)
humans_day0_mean <- apply(as.data.frame(mean_tech_reps[,1:6]),1, mean)
dim(humans_day0_mean)
humans_day0_var <- as.data.frame(apply(as.data.frame(mean_tech_reps[,1:6]),1, var) )
dim(humans_day0_var)
humans_day0_mean <- apply(as.data.frame(mean_tech_reps[,1:6]),1, mean)
dim(humans_day0_mean)
humans_day0_mean <-  as.data.frame(apply(as.data.frame(mean_tech_reps[,1:6]),1, mean))
colnames(humans_day0_mean) <- c("Mean")
chimps_day0_mean <- as.data.frame(apply(as.data.frame(mean_tech_reps[,7:10]),1, mean))
colnames(chimps_day0_mean) <- c("Mean")
humans_day1_mean <- as.data.frame(apply(as.data.frame(mean_tech_reps[,11:16]),1, mean))
colnames(humans_day1_mean) <- c("Mean")
chimps_day1_mean <- as.data.frame(apply(as.data.frame(mean_tech_reps[,17:20]),1, mean))
colnames(chimps_day1_mean) <- c("Mean")
humans_day2_mean <- as.data.frame(apply(as.data.frame(mean_tech_reps[,21:26]),1, mean))
colnames(humans_day2_mean) <- c("Mean")
chimps_day2_mean <- as.data.frame(apply(as.data.frame(mean_tech_reps[,27:30]),1, mean))
colnames(chimps_day2_mean) <- c("Mean")
humans_day3_mean <- as.data.frame(apply(as.data.frame(mean_tech_reps[,31:36]),1, mean))
colnames(humans_day3_mean) <- c("Mean")
chimps_day3_mean <- as.data.frame(apply(as.data.frame(mean_tech_reps[,37:40]),1, mean))
colnames(chimps_day3_mean) <- c("Mean")
HC_mean <- rbind(as.data.frame(chimps_day0_mean), as.data.frame(chimps_day1_mean), as.data.frame(chimps_day2_mean), as.data.frame(chimps_day3_mean), as.data.frame(humans_day0_mean), as.data.frame(humans_day1_mean), as.data.frame(humans_day2_mean), as.data.frame(humans_day3_mean))
HC_mean_labels <- cbind(HC_mean, labels, labels10)
m <- ggplot(HC_mean_labels, aes(x = factor(labels), y = HC_mean))
m <- m + geom_violin(aes(fill = factor(labels10)), show.legend = FALSE) + geom_boxplot(aes(fill = factor(labels10)), show.legend = FALSE, outlier.shape = NA,width=0.2) + scale_y_continuous(trans = "log2") + ggtitle("Mean for each gene by species and day") + xlab("Species-Day Pair") + ylab("Mean for each gene")
m <- m + scale_x_discrete(labels=c("1" = "C Day 0", "2" = "C Day 1", "3" = "C Day 2", "4" = "C Day 3", "5" = "H Day 0", "6" = "H Day 1", "7" = "H Day 2", "8" = "H Day 3"))
m
group <- rbind(labels1, labels2, labels3, labels4)
mean_day_species <- rbind(chimps_day0_mean,chimps_day1_mean, chimps_day2_mean, chimps_day3_mean)
aov_groups <- cbind(mean_day_species, group)
dim(aov_groups)
aov_bet <- oneway.test(aov_groups$Mean ~ aov_groups$group)
aov_bet
t.test(chimps_day0_mean, chimps_day1_mean) # 0.4586
t.test(chimps_day0_1_mean, chimps_day1_var, alternative = "greater")
t.test(chimps_day0_mean, chimps_day1_var, alternative = "greater")
t.test(chimps_day0_mean, chimps_day1_mean, alternative = "greater")
t.test(chimps_day1_mean, chimps_day2_mean) # 0.03103
t.test(chimps_day2_mean, chimps_day3_mean) # 2.992e-06
mean_day_species <- rbind(humans_day0_mean,humans_day1_mean, humans_day2_mean, humans_day3_mean)
aov_groups <- cbind(mean_day_species, group)
dim(aov_groups)
aov_bet <- oneway.test(aov_groups$Mean ~ aov_groups$group)
aov_bet
t.test(humans_day0_mean, humans_day1_mean) # < 2.2e-16
t.test(humans_day1_mean, humans_day2_mean) # < 2.2e-16
t.test(humans_day2_mean, humans_day3_mean) # 7.301e-07
group <- rbind(labels1, labels2, labels3, labels4)
var_day_species <- rbind(chimps_day0_var,chimps_day1_var, chimps_day2_var, chimps_day3_var)
aov_groups <- cbind(var_day_species, group)
dim(aov_groups)
aov_bet <- oneway.test(aov_groups$Variance ~ aov_groups$group)
aov_bet
t.test(chimps_day0_var, chimps_day1_var) # 0.4586
t.test(chimps_day0_var, chimps_day1_var, alternative = "greater")
t.test(chimps_day1_var, chimps_day2_var) # 0.03103
t.test(chimps_day1_var, chimps_day2_var) # 0.03103
# Day 2 and Day 3
t.test(chimps_day2_var, chimps_day3_var) # 2.992e-06
find_qqplot_red_chimps <- function(chimp_begin_column_tm1, chimp_end_column_tm1, chimp_begin_column_t, chimp_end_column_t, human_begin_column_tm1, human_end_column_tm1, human_begin_column_t, human_end_column_t){
# Make an array to store the Chimp p-values
chimp_var_pval <- array(NA, dim = c(10304, 1))
for(i in 1:10304){
x <- t(mean_tech_reps[i,chimp_begin_column_tm1:chimp_end_column_tm1])
y <- t(mean_tech_reps[i,chimp_begin_column_t:chimp_end_column_t])
htest <- var.test(x, y, alternative = c("greater"))
chimp_var_pval[i,1] <- htest$p.value
}
hist(chimp_var_pval)
############## For humans
human_var_pval <- array(NA, dim = c(10304, 1))
for(i in 1:10304){
x <- t(mean_tech_reps[i,human_begin_column_tm1:human_end_column_tm1])
y <- t(mean_tech_reps[i,human_begin_column_t:human_end_column_t])
htest <- var.test(x, y, alternative = c("greater"))
human_var_pval[i,1] <- htest$p.value
}
hist(human_var_pval)
############ Find p-values of the F_statistics
# Make one data frame
var_pval <- as.data.frame(cbind(chimp_var_pval, human_var_pval))
rownames(var_pval) <- rownames(mean_tech_reps)
colnames(var_pval) <- c("Chimpanzee", "Human")
summary(var_pval)
dim(var_pval)
# Set p-value
p_val <- 0.05
# P-val < 0.05 for chimps only
num_var_pval_chimps <- var_pval[ which(var_pval[,1] < p_val), ]
# P-val < 0.05 for humans only
num_var_pval_humans <- var_pval[ which(var_pval[,2] < p_val), ]
# A data frame with the # of genes with significant p-values
sig_p_val <- as.data.frame(rbind(dim(num_var_pval_chimps), dim(num_var_pval_humans)))[,1]
# Run for the chimps
num_var_pval_chimps_neg_log <- -log10(var_pval[,1])
res_chimp <- newqqplot(num_var_pval_chimps_neg_log, -1, 100)
# Run for the shared
# Find the p-values of the chimps given that it was significant in the humans
subset_var <- as.data.frame(var_pval[ which(var_pval[,2] < 0.05), 1:2])
num_var_pval_chimp_given_human_no_df <- subset_var[,1]
num_var_pval_chimp_given_human <- as.data.frame(subset_var[,1])
num_var_pval_shared_neg_log <- -log10(num_var_pval_chimp_given_human)
res_shared <- addqqplot(num_var_pval_shared_neg_log[,1], -1, 100, pal[3])
# Information for plotting
list_values = list(chimp_var_pval, num_var_pval_chimp_given_human_no_df, sig_p_val, res_chimp$x, res_chimp$y, res_shared$x, res_shared$y, max(res_chimp$x), max(res_chimp$y),  max(res_shared$x),  max(res_shared$y))
return(list_values)
}
qqplot_red_day01 <- find_qqplot_red_chimps(7,10,17,20,1,6,11,16)
#adds a set of qq points to an existing graph
addqqplot=function(pvals, always.plot,density, col_designated){
len = length(pvals)
res=qqplot(-log10((1:len)/(1+len)),pvals,plot.it=F)
return(res)
}
#newqqplot creates a new plot with a set of qq points
#Output:
#creates a new qq plot
newqqplot=function(pvals, always.plot,density){
len = length(pvals)
res=qqplot(-log10((1:len)/(1+len)),pvals,plot.it=F)
}
qqplot_red_day01 <- find_qqplot_red_chimps(7,10,17,20,1,6,11,16)
plot(qqplot_red_day01[[4]],qqplot_red_day01[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved", main = "Day 0 to 1")
abline(0,1, col = "black")
points(qqplot_red_day01[[6]],qqplot_red_day01[[7]], pch = 16, col = pal[3])
qqplot_red_day12 <- find_qqplot_red_chimps(17,20,27,30,11,16,21,26)
qqplot_red_day23 <- find_qqplot_red_chimps(27,30,37,40,21,26,31,36)
qqplot_red_day02 <- find_qqplot_red_chimps(7,10,27,30,1,6,21,26)
find_qqplot_inc_chimps <- function(chimp_begin_column_tm1, chimp_end_column_tm1, chimp_begin_column_t, chimp_end_column_t, human_begin_column_tm1, human_end_column_tm1, human_begin_column_t, human_end_column_t){
# Make an array to store the Chimp p-values
chimp_var_pval <- array(NA, dim = c(10304, 1))
for(i in 1:10304){
x <- t(mean_tech_reps[i,chimp_begin_column_tm1:chimp_end_column_tm1])
y <- t(mean_tech_reps[i,chimp_begin_column_t:chimp_end_column_t])
htest <- var.test(x, y, alternative = c("less"))
chimp_var_pval[i,1] <- htest$p.value
}
hist(chimp_var_pval)
############## For humans
human_var_pval <- array(NA, dim = c(10304, 1))
for(i in 1:10304){
x <- t(mean_tech_reps[i,human_begin_column_tm1:human_end_column_tm1])
y <- t(mean_tech_reps[i,human_begin_column_t:human_end_column_t])
htest <- var.test(x, y, alternative = c("less"))
human_var_pval[i,1] <- htest$p.value
}
hist(human_var_pval)
############ Find p-values of the F_statistics
# Make one data frame
var_pval <- as.data.frame(cbind(chimp_var_pval, human_var_pval))
rownames(var_pval) <- rownames(mean_tech_reps)
colnames(var_pval) <- c("Chimpanzee", "Human")
summary(var_pval)
dim(var_pval)
# Set p-value
p_val <- 0.05
# P-val < 0.05 for chimps only
num_var_pval_chimps <- var_pval[ which(var_pval[,1] < p_val), ]
# P-val < 0.05 for humans only
num_var_pval_humans <- var_pval[ which(var_pval[,2] < p_val), ]
# A data frame with the # of genes with significant p-values
sig_p_val <- as.data.frame(rbind(dim(num_var_pval_chimps), dim(num_var_pval_humans)))[,1]
# Run for the chimps
num_var_pval_chimps_neg_log <- -log10(var_pval[,1])
res_chimp <- newqqplot(num_var_pval_chimps_neg_log, -1, 100)
# Run for the shared
# Find the p-values of the chimps given that it was significant in the humans
subset_var <- as.data.frame(var_pval[ which(var_pval[,2] < 0.05), 1:2])
num_var_pval_chimp_given_human_no_df <- subset_var[,1]
num_var_pval_chimp_given_human <- as.data.frame(subset_var[,1])
num_var_pval_shared_neg_log <- -log10(num_var_pval_chimp_given_human)
res_shared <- addqqplot(num_var_pval_shared_neg_log[,1], -1, 100, pal[3])
# Information for plotting
list_values = list(chimp_var_pval, num_var_pval_chimp_given_human_no_df, sig_p_val, res_chimp$x, res_chimp$y, res_shared$x, res_shared$y, max(res_chimp$x), max(res_chimp$y),  max(res_shared$x),  max(res_shared$y))
return(list_values)
}
qqplot_inc_day02 <- find_qqplot_inc_chimps(7,10,27,30,1,6,21,26)
qqplot_inc_day23 <- find_qqplot_inc_chimps(27,30,37,40,21,26,31,36)
qqplot_inc_day12 <- find_qqplot_inc_chimps(17,20,27,30,11,16,21,26)
qqplot_inc_day01 <- find_qqplot_inc_chimps(7,10,17,20,1,6,11,16)
par(mfrow=c(2,4),oma = c(2, 2, 2, 2))
# Reduction of variance to day 0 to 1 chimps
plot(qqplot_red_day01[[4]],qqplot_red_day01[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved", main = "Day 0 to 1")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_red_day01[[6]],qqplot_red_day01[[7]], pch = 16, col = pal[3])
# Reduction of variance to day 1 to 2
plot(qqplot_red_day12[[4]],qqplot_red_day12[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved", main = "Day 1 to 2")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_red_day12[[6]],qqplot_red_day12[[7]], pch = 16, col = pal[3])
# Reduction of variance to day 2 to 3
plot(qqplot_red_day23[[4]],qqplot_red_day23[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved", main = "Day 2 to 3")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_red_day23[[6]],qqplot_red_day23[[7]], pch = 16, col = pal[3])
# Reduction of variance to day 0 to 2
plot(qqplot_red_day02[[4]],qqplot_red_day02[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved", main = "Day 0 to 2")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_red_day02[[6]],qqplot_red_day02[[7]], pch = 16, col = pal[3])
# Add bottom title
mtext("Reduction in Variation", font = 2, side = 3, line = -1.5, outer = TRUE)
### Increase in variance
# Inc variance to day 0 to 1
plot(qqplot_inc_day01[[4]],qqplot_inc_day01[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved",  main = "Day 0 to 1")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_inc_day01[[6]],qqplot_inc_day01[[7]], pch = 16, col = pal[3])
# Increase of variance to day 1 to 2
plot(qqplot_inc_day12[[4]],qqplot_inc_day12[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved",  main = "Day 1 to 2")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_inc_day12[[6]],qqplot_inc_day12[[7]], pch = 16, col = pal[3])
# Increase of variance to day 2 to 3
plot(qqplot_inc_day23[[4]],qqplot_inc_day23[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved",  main = "Day 2 to 3")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_inc_day23[[6]],qqplot_inc_day23[[7]], pch = 16, col = pal[3])
# Increase of variance to day 0 to 2
plot(qqplot_inc_day02[[4]],qqplot_inc_day02[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved",  main = "Day 0 to 2")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_inc_day02[[6]],qqplot_inc_day02[[7]], pch = 16, col = pal[3])
mtext("Increase in Variation", font = 2, side = 3, line = -29, outer = TRUE)
par(fig = c(0, 1, 0, 1), oma = c(0, 0, 0, 0), mar = c(0, 0, 0, 0), new = TRUE)
plot(0, 0, type = "n", bty = "n", xaxt = "n", yaxt = "n")
legend("bottomright", c("Chimpanzee", "Shared"), xpd = TRUE, horiz = TRUE, inset = c(0,
0), bty = "n", pch = c(16, 16), col = pal[2:3], cex = 1.5)
find_qqplot_red_humans <- function(chimp_begin_column_tm1, chimp_end_column_tm1, chimp_begin_column_t, chimp_end_column_t, human_begin_column_tm1, human_end_column_tm1, human_begin_column_t, human_end_column_t){
# Make an array to store the Chimp p-values
chimp_var_pval <- array(NA, dim = c(10304, 1))
for(i in 1:10304){
x <- t(mean_tech_reps[i,chimp_begin_column_tm1:chimp_end_column_tm1])
y <- t(mean_tech_reps[i,chimp_begin_column_t:chimp_end_column_t])
htest <- var.test(x, y, alternative = c("greater"))
chimp_var_pval[i,1] <- htest$p.value
}
hist(chimp_var_pval)
############## For humans
human_var_pval <- array(NA, dim = c(10304, 1))
for(i in 1:10304){
x <- t(mean_tech_reps[i,human_begin_column_tm1:human_end_column_tm1])
y <- t(mean_tech_reps[i,human_begin_column_t:human_end_column_t])
htest <- var.test(x, y, alternative = c("greater"))
human_var_pval[i,1] <- htest$p.value
}
hist(human_var_pval)
############ Find p-values of the F_statistics
# Make one data frame
var_pval <- as.data.frame(cbind(chimp_var_pval, human_var_pval))
rownames(var_pval) <- rownames(mean_tech_reps)
colnames(var_pval) <- c("Chimpanzee", "Human")
summary(var_pval)
dim(var_pval)
# Set p-value
p_val <- 0.05
# P-val < 0.05 for chimps only
num_var_pval_chimps <- var_pval[ which(var_pval[,1] < p_val), ]
# P-val < 0.05 for humans only
num_var_pval_humans <- var_pval[ which(var_pval[,2] < p_val), ]
# A data frame with the # of genes with significant p-values
sig_p_val <- as.data.frame(rbind(dim(num_var_pval_chimps), dim(num_var_pval_humans)))[,1]
# Run for the humans
num_var_pval_chimps_neg_log <- -log10(var_pval[,1])
res_chimp <- newqqplot(num_var_pval_chimps_neg_log, -1, 100)
# Run for the shared
# Find the p-values of the humans given that it was significant in the chimps
subset_var <- as.data.frame(var_pval[ which(var_pval[,1] < 0.05), 1:2])
num_var_pval_human_given_chimp_no_df <- subset_var[,2]
num_var_pval_human_given_chimp <- as.data.frame(subset_var[,2])
num_var_pval_shared_neg_log <- -log10(num_var_pval_human_given_chimp)
res_shared <- addqqplot(num_var_pval_shared_neg_log[,1], -1, 100, pal[3])
# Information for plotting
list_values = list(chimp_var_pval, num_var_pval_human_given_chimp_no_df, sig_p_val, res_chimp$x, res_chimp$y, res_shared$x, res_shared$y, max(res_chimp$x), max(res_chimp$y),  max(res_shared$x),  max(res_shared$y))
return(list_values)
}
find_qqplot_inc_humans <- function(chimp_begin_column_tm1, chimp_end_column_tm1, chimp_begin_column_t, chimp_end_column_t, human_begin_column_tm1, human_end_column_tm1, human_begin_column_t, human_end_column_t){
# Make an array to store the Chimp p-values
chimp_var_pval <- array(NA, dim = c(10304, 1))
for(i in 1:10304){
x <- t(mean_tech_reps[i,chimp_begin_column_tm1:chimp_end_column_tm1])
y <- t(mean_tech_reps[i,chimp_begin_column_t:chimp_end_column_t])
htest <- var.test(x, y, alternative = c("less"))
chimp_var_pval[i,1] <- htest$p.value
}
hist(chimp_var_pval)
############## For humans
human_var_pval <- array(NA, dim = c(10304, 1))
for(i in 1:10304){
x <- t(mean_tech_reps[i,human_begin_column_tm1:human_end_column_tm1])
y <- t(mean_tech_reps[i,human_begin_column_t:human_end_column_t])
htest <- var.test(x, y, alternative = c("less"))
human_var_pval[i,1] <- htest$p.value
}
hist(human_var_pval)
############ Find p-values of the F_statistics
# Make one data frame
var_pval <- as.data.frame(cbind(chimp_var_pval, human_var_pval))
rownames(var_pval) <- rownames(mean_tech_reps)
colnames(var_pval) <- c("Chimpanzee", "Human")
summary(var_pval)
dim(var_pval)
# Set p-value
p_val <- 0.05
# P-val < 0.05 for chimps only
num_var_pval_chimps <- var_pval[ which(var_pval[,1] < p_val), ]
# P-val < 0.05 for humans only
num_var_pval_humans <- var_pval[ which(var_pval[,2] < p_val), ]
# A data frame with the # of genes with significant p-values
sig_p_val <- as.data.frame(rbind(dim(num_var_pval_chimps), dim(num_var_pval_humans)))[,1]
# Run for the humans
num_var_pval_chimps_neg_log <- -log10(var_pval[,1])
res_chimp <- newqqplot(num_var_pval_chimps_neg_log, -1, 100)
# Run for the shared
# Find the p-values of the humans given that it was significant in the chimps
subset_var <- as.data.frame(var_pval[ which(var_pval[,1] < 0.05), 1:2])
num_var_pval_human_given_chimp_no_df <- subset_var[,2]
num_var_pval_human_given_chimp <- as.data.frame(subset_var[,2])
num_var_pval_shared_neg_log <- -log10(num_var_pval_human_given_chimp)
res_shared <- addqqplot(num_var_pval_shared_neg_log[,1], -1, 100, pal[3])
# Information for plotting
list_values = list(chimp_var_pval, num_var_pval_human_given_chimp_no_df, sig_p_val, res_chimp$x, res_chimp$y, res_shared$x, res_shared$y, max(res_chimp$x), max(res_chimp$y),  max(res_shared$x),  max(res_shared$y))
return(list_values)
}
par(fig = c(0, 1, 0, 1), oma = c(0, 0, 0, 0), mar = c(0, 0, 0, 0), new = TRUE)
plot(0, 0, type = "n", bty = "n", xaxt = "n", yaxt = "n")
legend("bottomright", c("Chimpanzee", "Shared"), xpd = TRUE, horiz = TRUE, inset = c(0,  0), bty = "n", pch = c(16, 16), col = pal[2:3], cex = 1.5)
qqplot_red_day01 <- find_qqplot_red_humans(7,10,17,20,1,6,11,16)
# Reduction in variance from day 1 to day 2 humans
qqplot_red_day12 <- find_qqplot_red_humans(17,20,27,30,11,16,21,26)
# Reduction in variance from day 2 to day 3 humans
qqplot_red_day23 <- find_qqplot_red_humans(27,30,37,40,21,26,31,36)
# Reduction in variance from day 0 to day 2 humans
qqplot_red_day02 <- find_qqplot_red_humans(7,10,27,30,1,6,21,26)
# Inc. in variance from day 0 to day 1 humans
qqplot_inc_day01 <- find_qqplot_inc_humans(7,10,17,20,1,6,11,16)
# Inc. in variance from day 1 to day 2 humans
qqplot_inc_day12 <- find_qqplot_inc_humans(17,20,27,30,11,16,21,26)
# Inc. in variance from day 2 to day 3 humans
qqplot_inc_day23 <- find_qqplot_inc_humans(27,30,37,40,21,26,31,36)
# Inc. in variance from day 0 to day 2
qqplot_inc_day02 <- find_qqplot_inc_humans(7,10,27,30,1,6,21,26)
# Reduction of variance qqplots- humans
dev.off()
par(mfrow=c(2,4),oma = c(2, 2, 2, 2))
# Reduction of variance to day 0 to 1 chimps
plot(qqplot_red_day01[[4]],qqplot_red_day01[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved", main = "Day 0 to 1")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_red_day01[[6]],qqplot_red_day01[[7]], pch = 16, col = pal[3])
# Reduction of variance to day 1 to 2
plot(qqplot_red_day12[[4]],qqplot_red_day12[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved", main = "Day 1 to 2")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_red_day12[[6]],qqplot_red_day12[[7]], pch = 16, col = pal[3])
# Reduction of variance to day 2 to 3
plot(qqplot_red_day23[[4]],qqplot_red_day23[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved", main = "Day 2 to 3")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_red_day23[[6]],qqplot_red_day23[[7]], pch = 16, col = pal[3])
# Reduction of variance to day 0 to 2
plot(qqplot_red_day02[[4]],qqplot_red_day02[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved", main = "Day 0 to 2")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_red_day02[[6]],qqplot_red_day02[[7]], pch = 16, col = pal[3])
# Add bottom title
mtext("Reduction in Variation", font = 2, side = 3, line = -1.5, outer = TRUE)
### Increase in variance
# Inc variance to day 0 to 1
plot(qqplot_inc_day01[[4]],qqplot_inc_day01[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved",  main = "Day 0 to 1")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_inc_day01[[6]],qqplot_inc_day01[[7]], pch = 16, col = pal[3])
# Increase of variance to day 1 to 2
plot(qqplot_inc_day12[[4]],qqplot_inc_day12[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved",  main = "Day 1 to 2")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_inc_day12[[6]],qqplot_inc_day12[[7]], pch = 16, col = pal[3])
# Increase of variance to day 2 to 3
plot(qqplot_inc_day23[[4]],qqplot_inc_day23[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved",  main = "Day 2 to 3")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_inc_day23[[6]],qqplot_inc_day23[[7]], pch = 16, col = pal[3])
# Increase of variance to day 0 to 2
plot(qqplot_inc_day02[[4]],qqplot_inc_day02[[5]], pch = 16, xlim = c(0,6), ylim = c(0,6), col = pal[2], xlab = "-log10(p) Expected", ylab = "-log10(p) Obeserved",  main = "Day 0 to 2")
abline(0,1, col = "black")
# Add to the plot
points(qqplot_inc_day02[[6]],qqplot_inc_day02[[7]], pch = 16, col = pal[3])
mtext("Increase in Variation", font = 2, side = 3, line = -29, outer = TRUE)
par(fig = c(0, 1, 0, 1), oma = c(0, 0, 0, 0), mar = c(0, 0, 0, 0), new = TRUE)
plot(0, 0, type = "n", bty = "n", xaxt = "n", yaxt = "n")
legend("bottomright", c("Human", "Human given significant in chimpanzee"), xpd = TRUE, horiz = TRUE, inset = c(0,  0), bty = "n", pch = c(16, 16), col = pal[2:3], cex = 1.5)

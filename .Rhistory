getwd()
getwd()
source("functions.R")
library("limma")
library("edgeR")
library(ggplot2)
theme_set(theme_bw(base_size = 16))
annotation_filter <- read.table("../data/annotation-filter.txt",
header = TRUE,
stringsAsFactors = FALSE)
getwd()
annotation_filter <- read.table("./data/annotation-filter.txt",
header = TRUE,
stringsAsFactors = FALSE)
head(annotation_map())
head(annotation_filter)
molecules <- read.table("./data/molecules-final.txt",
header = TRUE,
stringsAsFactors = FALSE)
dim(molecules)
dim(annotation_filter)
library(devtools)
install_github("jhsiao999/Humanzee")
library(Humanzee)
block <- annotation_filter$batch
design <- model.matrix(~ 1 + individual, data = annotation_filter)
dup_corrs <- duplicateCorrelation(molecules,
design = design, block = block)
dup_corrs_file <- "./analysis/rda/dup-corrs.rda"
save(dup_corrs, file = dup_corrs_file)
limma_fit_file <- "./analysis/rda/limma-fit.rda"
gls_fit <- Humanzee::ruv_mixed_model(molecules,
ndups = 1,
design = design, block = block,
correlation = dup_corrs$cons)
save(gls_fit, file = limma_fit_file)
molecules_corrected <- t( design %*% t(gls_fit$coef) ) + gls_fit$resid
pca_final <- run_pca(molecules_corrected)
source("functions.R")
source("./codes/functions.R")
source("./code/functions.R")
pca_final <- run_pca(molecules_corrected)
pca_final_plot <- plot_pca(pca_final$PCs, explained = pca_final$explained,
metadata = anno_filter, color = "individual",
shape = "replicate") +
labs(title = "Molecules (batch corrected) for single cells")
pca_final_plot <- plot_pca(pca_final$PCs, explained = pca_final$explained,
metadata = annotation_filter, color = "individual",
shape = "replicate") +
labs(title = "Molecules (batch corrected) for single cells")
pca_final_plot
sessionInfo()
source("./code/functions.R")
